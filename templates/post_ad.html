<!DOCTYPE html>
<html lang="en" data-theme="{{ 'dark' if request.cookies.get('theme') == 'dark' else 'light' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post an Ad - Secret Bay</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <style>
        :root {
            --primary-color: #1e5a8e;
            --ocean-blue: #006994;
            --accent-color: #FF6B35;
            --secondary-color: #f0f8ff;
            --card-bg: #fff;
            --text-color: #2c3e50;
            --border-color: #e9ecef;
        }
        [data-theme="dark"] {
            --primary-color: #4a90e2;
            --ocean-blue: #00334d;
            --accent-color: #FF6B35;
            --secondary-color: #181c24;
            --card-bg: #1b2838;
            --text-color: #e0e0e0;
            --border-color: #2d3748;
        }

        body {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .post-ad-section {
            background: var(--card-bg);
            padding: 40px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-color);
        }

        .form-card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .form-help {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    {% include 'navbar.html' %}

    <div class="post-ad-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8 text-center">
                    <h1 class="display-5 mb-3">Post an Ad</h1>
                    <p class="lead">List your boat or sailing gear on Sailor's Bay marketplace</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                {% with messages = get_flashed_messages(with_categories=true) %}
                  {% if messages %}
                    {% for category, message in messages %}
                      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                      </div>
                    {% endfor %}
                  {% endif %}
                {% endwith %}

                <div class="form-card">
                    <form method="post" id="postAdForm" enctype="multipart/form-data">
                        <h4 class="mb-4">Product Details</h4>
                        
                        <div class="mb-3">
                            <label for="title" class="form-label">Title <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="title" name="title" required maxlength="200" placeholder="e.g., Vintage Camera, Office Desk, etc.">
                            <div class="form-help">Give your item a clear, descriptive title</div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="5" placeholder="Describe your item in detail, including condition, features, and any relevant information..."></textarea>
                            <div class="form-help">Provide detailed information to attract buyers</div>
                        </div>

                        <!-- Listing Type Selection -->
                        <div class="mb-4">
                            <label class="form-label">Listing Type</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="listing_type" id="regular_listing" value="regular" checked onchange="toggleListingType()">
                                <label class="form-check-label" for="regular_listing">
                                    <strong>Regular Listing</strong> - Sell at a fixed price
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_auction" id="auction_listing" onchange="toggleListingType()">
                                <label class="form-check-label" for="auction_listing">
                                    <strong>üî® Auction (One-of-a-Kind)</strong> - Let buyers bid on your unique item
                                </label>
                            </div>
                        </div>

                        <!-- Regular Listing Fields -->
                        <div id="regular_fields">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="price" class="form-label">Price ($) <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="price" name="price" min="0" step="0.01" placeholder="0.00">
                                    <div class="form-help">Set a competitive price</div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label for="stock" class="form-label">Quantity <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="stock" name="stock" min="0" value="1">
                                    <div class="form-help">How many do you have?</div>
                                </div>
                            </div>
                        </div>

                        <!-- Auction Fields -->
                        <div id="auction_fields" style="display: none;">
                            <div class="alert alert-warning">
                                <strong>‚ÑπÔ∏è Auction Items:</strong> Auctions are for one-of-a-kind items only. Quantity is automatically set to 1.
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="starting_bid" class="form-label">Starting Bid ($) <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="starting_bid" name="starting_bid" min="0.01" step="0.01" placeholder="0.00">
                                    <div class="form-help">Minimum bid to start the auction</div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label for="auction_duration" class="form-label">Duration (Days) <span class="text-danger">*</span></label>
                                    <select class="form-select" id="auction_duration" name="auction_duration">
                                        <option value="1">1 Day</option>
                                        <option value="3">3 Days</option>
                                        <option value="5">5 Days</option>
                                        <option value="7" selected>7 Days</option>
                                        <option value="10">10 Days</option>
                                        <option value="14">14 Days</option>
                                        <option value="30">30 Days</option>
                                    </select>
                                    <div class="form-help">How long the auction will run</div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="reserve_price" class="form-label">Reserve Price ($) <small class="text-muted">(Optional)</small></label>
                                    <input type="number" class="form-control" id="reserve_price" name="reserve_price" min="0" step="0.01" placeholder="Leave blank for no reserve">
                                    <div class="form-help">Minimum price you'll accept (hidden from bidders)</div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label for="buy_now_price" class="form-label">Buy Now Price ($) <small class="text-muted">(Optional)</small></label>
                                    <input type="number" class="form-control" id="buy_now_price" name="buy_now_price" min="0" step="0.01" placeholder="Leave blank to disable">
                                    <div class="form-help">Instant win price - ends auction immediately</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="category" class="form-label">Category <span class="text-danger">*</span></label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="Sailboats">Sailboats</option>
                                    <option value="Gear">Gear</option>
                                    <option value="Rigging">Rigging</option>
                                    <option value="Sails">Sails</option>
                                    <option value="Safety">Safety</option>
                                    <option value="Accessories">Accessories</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Product Image</label>
                            <div class="mb-3">
                                <label for="image_file" class="form-label">Upload Image <small class="text-muted">(Recommended)</small></label>
                                <input type="file" class="form-control" id="image_file" name="image_file" accept="image/png,image/jpeg,image/jpg,image/gif,image/webp" onchange="previewImage(event)">
                                <div class="form-help">PNG, JPG, GIF, or WebP (max 5MB)</div>
                            </div>
                            <div id="imagePreview" class="mb-3" style="display:none;">
                                <img id="previewImg" src="" alt="Preview" style="max-width: 300px; max-height: 200px; border-radius: 8px; border: 2px solid #ddd;">
                            </div>
                            <div class="mb-3">
                                <label for="image_url" class="form-label">Or Enter Image URL <small class="text-muted">(Alternative)</small></label>
                                <input type="text" class="form-control" id="image_url" name="image_url" placeholder="https://example.com/image.jpg">
                                <div class="form-help">Use a URL if your image is hosted elsewhere</div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <strong>üìå Tips for a successful listing:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Use a clear, descriptive title</li>
                                <li>Include detailed product information</li>
                                <li>Set a fair, competitive price</li>
                                <li>Add a high-quality product image</li>
                                <li>Update stock when items sell</li>
                            </ul>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                            <a href="{{ url_for('products') }}" class="btn btn-outline-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary btn-lg">
                                üì¢ Post Ad
                            </button>
                        </div>
                    </form>
                </div>

                <div class="form-card">
                    <h5>Need Help?</h5>
                    <p class="text-muted mb-0">
                        If you have questions about posting ads, check out our <a href="{{ url_for('help') }}">Help Center</a> or 
                        <a href="{{ url_for('contact') }}">contact support</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>

    {% include 'footer.html' %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Preview uploaded image
        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('imagePreview').style.display = 'none';
            }
        }

        // Toggle between regular and auction listing types
        function toggleListingType() {
            const isAuction = document.getElementById('auction_listing').checked;
            const regularFields = document.getElementById('regular_fields');
            const auctionFields = document.getElementById('auction_fields');
            
            if (isAuction) {
                regularFields.style.display = 'none';
                auctionFields.style.display = 'block';
                // Make auction fields required
                document.getElementById('starting_bid').required = true;
                // Make regular fields not required
                document.getElementById('price').required = false;
                document.getElementById('stock').required = false;
            } else {
                regularFields.style.display = 'block';
                auctionFields.style.display = 'none';
                // Make regular fields required
                document.getElementById('price').required = true;
                document.getElementById('stock').required = true;
                // Make auction fields not required
                document.getElementById('starting_bid').required = false;
            }
        }

        // Form validation
        document.getElementById('postAdForm').addEventListener('submit', function(e) {
            const isAuction = document.getElementById('auction_listing').checked;
            
            if (isAuction) {
                const startingBid = parseFloat(document.getElementById('starting_bid').value);
                const reservePrice = document.getElementById('reserve_price').value ? parseFloat(document.getElementById('reserve_price').value) : null;
                const buyNowPrice = document.getElementById('buy_now_price').value ? parseFloat(document.getElementById('buy_now_price').value) : null;
                
                if (startingBid <= 0) {
                    e.preventDefault();
                    alert('Starting bid must be greater than 0');
                    return false;
                }
                
                if (reservePrice && reservePrice < startingBid) {
                    e.preventDefault();
                    alert('Reserve price must be greater than or equal to starting bid');
                    return false;
                }
                
                if (buyNowPrice && buyNowPrice < startingBid) {
                    e.preventDefault();
                    alert('Buy Now price must be greater than or equal to starting bid');
                    return false;
                }
            } else {
                const price = parseFloat(document.getElementById('price').value);
                const stock = parseInt(document.getElementById('stock').value);
                
                if (price < 0) {
                    e.preventDefault();
                    alert('Price cannot be negative');
                    return false;
                }
                
                if (stock < 0) {
                    e.preventDefault();
                    alert('Quantity cannot be negative');
                    return false;
                }
            }
            
            return true;
        });
    </script>
</body>
</body>
<script src="/static/js/theme.js"></script>
</html>